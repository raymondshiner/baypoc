embedded_svc.defineFeature("LiveAgent",function(b){function r(a,c){this.name=a;this.data=c}function k(a){this.liveAgentAPI=a;this.running=!1;this.pingScript=this.pingTimeoutTimer=void 0;this.sid=b.getCookie("liveagent_sid")}function l(){this.createElements();this.registerMessageHandlers()}function n(){this.visitCount=0;this.originalReferrer=void 0;this.pages=[]}function g(){this.connection=new k(this);this.fileTransfer=new l;this.visitorInfo=new n;this.browserSessionInfo={};this.INVITATIONS_CONTAINER_ID=
"esw-invite-container";this.INVITE_RESOURCE_ID="esw-invite-resource";this.INVITE_API_ID="esw-invite-api";this.inviteButton={};this.hasInvitationsLoaded=!!document.getElementById("snapins_invite");this.isInvitationsRendered=!!document.getElementById("snapins_invite");b.setDefaultButtonText("LiveAgent","Chat with an Expert","Agent Offline","Live chat:");b.addDefaultSetting("avatarImgURL","");b.addDefaultSetting("prechatBackgroundImgURL","");b.addDefaultSetting("waitingStateBackgroundImgURL","");b.addDefaultSetting("smallCompanyLogoImgURL",
"");b.addDefaultSetting("headerBackgroundURL","");b.addDefaultSetting("extraPrechatInfo",[]);b.addDefaultSetting("extraPrechatFormDetails",[]);b.addDefaultSetting("agentAvailableOnButtonClick",!1);b.settings.isOfflineSupportEnabled&&(b.settings.offlineSupportMinimizedText=b.settings.offlineSupportMinimizedText||"Contact Us");b.addMessageHandler("liveagent.chatCanceledOnDifferentTab",);b.addEventHandler("error",this.disconnect.bind(this));
b.addEventHandler("sessionDataRetrieved",function(a){q=embedded_svc.liveAgentAPI.constructChatSettingsEndpointURL();a.CHASITOR_SERIALIZED_KEY?(b.settings.agentAvailableOnButtonClick=!0,this.ping()):(embedded_svc.menu||embedded_svc.settings.disableDeploymentDataPrefetch||embedded_svc.liveAgentAPI.getChatSettings(),b.loadFeatureScript("Invite",function(){embedded_svc.liveAgentAPI.getButtonSettings();document.querySelector("style#inert-style")||b.loadScriptFromDirectory("utils","inert")}));this.visitorInfo.initialize(a);
return!!a.CHASITOR_SERIALIZED_KEY}.bind(this));b.addEventHandler("beforeCreate",.bind(this));b.addEventHandler("validateInit",.bind(this));b.addEventHandler("onSettingsCallCompleted",function(){b.liveAgentAPI.hasInviteButton()&&this.hasInvitationsLoaded&&(this.isInvitationsRendered?t(b.liveAgentAPI.inviteButton):b.liveAgentAPI.appendInvitationsComponent())}.bind(this));b.addEventHandler("onInvitationResourceLoaded",.bind(this));
b.loadStorageScript("Chasitor");b.registerStorageKeys("CHASITOR_SERIALIZED_KEY LA_ESW_CHAT_SCROLL_POSITION LA_ESW_UNSEEN_MESSAGES LA_ESW_SHOW_QUEUE_POSITION LA_VISITOR_INFO LA_ESW_FILE_TOKEN LA_ESW_FILE_UPLOAD_SERVLET_URL CHATBOT_FOOTER_MENU PRECHAT_FORM_DETAILS PRECHAT_ENTITIES".split(" "));"LiveAgent"===b.settings.entryFeature&&this.updateButton()}var q,p=0;k.prototype.send=function(a,c){var d=c||{};c="Visitor";var e="",f=!1;if(this.pingScript)this.onError("SCRT did not handle response before sending another message.");else{1<a.length?(c="System",e="MultiNoun",d.nouns="",f=
!0):e=a[0].name;var m=b.settings.baseLiveAgentURL+"/rest/"+c+"/"+e+".jsonp?";a.forEach(function(h){f&&(d.nouns+=h.name+",");d[h.name+".prefix"]="Visitor";Object.getOwnPropertyNames(h.data).forEach(function(u){d[h.name+"."+u]=h.data[u]})});f&&(d.nouns=d.nouns.substr(0,d.nouns.length-1));Object.getOwnPropertyNames(d).forEach(function(h){m+=h+"="+d[h]+"&"});m+="callback=embedded_svc.liveAgentAPI.connection.handlePing&deployment_id="+b.settings.deploymentId+"&org_id="+b.settings.orgId+"&version=48";a=
document.createElement("script");a.type="text/javascript";a.src=m;this.pingScript=document.body.appendChild(a);this.pingTimeoutTimer=window.setTimeout(.bind(this),5E3)}};k.prototype.handlePing=function(a){this.pingTimeoutTimer&&(clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=void 0);this.running=!0;a.messages.forEach(function(c){this.messageHandler(c.type,c.message)}.bind(this));this.onSuccess();this.pingScript&&(document.body.removeChild(this.pingScript),
this.pingScript=void 0)};k.prototype.messageHandler=function(a,c){switch(a){case "Availability":this.liveAgentAPI.handleAvailability(c);break;case "SwitchServer":this.liveAgentAPI.handleSwitchServer(c);break;case "Settings":this.liveAgentAPI.handleSettings(c);break;default:b.log("Unexpected message of type "+a+": "+JSON.stringify(c))}};k.prototype.onSuccess=function(a){a=a||5E4;this.pingTimer&&clearTimeout(this.pingTimer);this.pingTimer=window.setTimeout(this.liveAgentAPI.ping.bind(this.liveAgentAPI),
a)};k.prototype.onError=;l.prototype.registerMessageHandlers=function(){b.addMessageHandler("liveagent.fileTransfer.uploadFile",.bind(this));b.addMessageHandler("liveagent.fileTransfer.resetFileSelector",.bind(this))};l.prototype.handleFileSelectorChange=;l.prototype.uploadFile=;l.prototype.resetFileSelector=;l.prototype.createElements=function(){var a=document.createElement("form"),c=document.createElement("input"),d=document.createElement("input"),e=document.createElement("iframe");a.id="fileUploadForm";a.enctype="multipart/form-data";a.method="post";a.target="fileUploadIframe";c.type="file";c.id="fileSelector";c.name="file";c.style.display="none";c.onchange=
this.handleFileSelectorChange;d.name="filename";d.type="hidden";e.id="fileUploadIframe";e.name="fileUploadIframe";e.title="FileUploadFrame";e.style.display="none";a.appendChild(c);a.appendChild(d);document.body.appendChild(a);document.body.appendChild(e)};n.prototype.initialize=function(a){a&&a.LA_VISITOR_INFO?(a=JSON.parse(a.LA_VISITOR_INFO),this.visitCount=a.visitCount,this.pages=a.pages,this.originalReferrer=a.originalReferrer||document.referrer):this.originalReferrer=document.referrer;this.visitCount+=
1;this.addCurrentPage();this.serialize()};n.prototype.serialize=function(){var a=JSON.stringify({visitCount:this.visitCount,originalReferrer:this.originalReferrer,pages:this.pages});embedded_svc?embedded_svc.setSessionData("LA_VISITOR_INFO",a):window.sessionStorage.setItem("LA_VISITOR_INFO",a)};n.prototype.getInfo=;n.prototype.addCurrentPage=function(){var a=window.location.href;this.pages.forEach(function(c,
d){c.location===a&&this.pages.splice(d,1)}.bind(this));this.pages.unshift({location:a,time:(new Date).getTime()})};g.prototype.ping=function(){var a={},c=[new r("Availability",{ids:"["+b.settings.buttonId+"]"})];b.log("Pinging server");this.connection.pingTimer=void 0;a.sid=this.sid;a.r=(new Date).getMilliseconds();this.connection.send(c,a)};g.prototype.getChatSettings=function(){embedded_svc.utils.loadScriptFromUrl(q);p+=1};g.prototype.constructChatSettingsEndpointURL=function(){var a=embedded_svc.settings.language,
c=embedded_svc.settings.eswConfigDevName;var d="?Settings.prefix=EmbeddedService&org_id="+embedded_svc.settings.orgId;d=d+("&EmbeddedServiceConfig.configName="+c)+"&callback=embedded_svc.liveAgentAPI.handleChatSettings&version=48";"string"===typeof a&&0<a.trim().length&&(d+="&EmbeddedServiceConfig.language="+a);return embedded_svc.settings.baseLiveAgentURL+"/rest/EmbeddedService/EmbeddedServiceConfig.jsonp"+d};g.prototype.handleChatSettings=function(a){var c={};a.messages.forEach(function(d){"EmbeddedServiceConfig"===
d.type?(embedded_svc.config=d.message,embedded_svc.utils.isCommunityOrSite()&&(c.ChatInvitation=b.liveAgentAPI.processInvitations),embedded_svc.utils.isMatchingCustomizationFound(embedded_svc.config,embedded_svc.settings.pageName)&&embedded_svc.utils.processCustomizations(embedded_svc.settings.pageName,embedded_svc.config,c)):"SwitchServer"===d.type?(embedded_svc.utils.warning("[Chat] Your org has been migrated on the Service Cloud Real Time servers. Consider regenerating the snippet for this page."),
embedded_svc.settings.baseLiveAgentURL=d.message.newUrl,p=0,q=embedded_svc.liveAgentAPI.constructChatSettingsEndpointURL(),embedded_svc.liveAgentAPI.getChatSettings()):"EmbeddedServiceError"===d.type||"Error"===d.type?1<=p||"EmbeddedServiceError"===d.type&&!d.message.shouldRetry?embedded_svc.utils.error("[Chat] "+d.type+" from jsonp call: "+d.message.text):(embedded_svc.log("[Chat] Getting chat settings failed. Retrying..Attempt:"+p),embedded_svc.liveAgentAPI.getChatSettings()):embedded_svc.utils.error("[Chat] Unexpected message type from jsonp call:"+
d.type)})};g.prototype.getButtonSettings=function(){var a=[],c={};this.sid&&(c.sid=this.sid,c.r=(new Date).getMilliseconds(),b.log("Reusing existing session."));a.push(new r("Settings",{buttonIds:"["+b.settings.buttonId+"]",updateBreadcrumb:1}));this.connection.send(a,c)};g.prototype.handleAvailability=function(a){b.log("Agent Available: "+JSON.stringify(a));a.results.forEach(function(c){var d=c.isAvailable;embedded_svc.utils.fireEvent("onAvailability",void 0,{isAgentAvailable:d,id:c.id});"LiveAgent"===
b.settings.entryFeature&&(b.settings.agentAvailableOnButtonClick=d,this.updateButton(d),b.inviteAPI&&b.inviteAPI.inviteButton.getTracker()&&b.inviteAPI.inviteButton.setOnlineState(d))}.bind(this))};g.prototype.handleSettings=function(a){var c;"string"===typeof a.contentServerUrl&&(embedded_svc.settings.baseLiveAgentContentURL=a.contentServerUrl);a.buttons.forEach(function(d){d.id===b.settings.buttonId&&(c=d.isAvailable,"Invite"===d.type&&(b.liveAgentAPI.inviteButton=d))});b.log("Agent Available: "+
JSON.stringify(c));"LiveAgent"===b.settings.entryFeature&&(b.settings.agentAvailableOnButtonClick=c,this.updateButton(c));embedded_svc.utils.fireEvent("onSettingsCallCompleted",void 0,{isAgentAvailable:c})};g.prototype.handleSwitchServer=;g.prototype.disconnect=;g.prototype.isButtonId=;g.prototype.isDeploymentId=;g.prototype.sendFileInfo=;g.prototype.sendCustomEvent=;g.prototype.getCustomEvents=;g.prototype.addCustomEventListener=;g.prototype.getSessionId=;g.prototype.updateButton=
function(a){b.settings.isOfflineSupportEnabled&&!a?(b.isButtonDisabled=!1,b.setHelpButtonText(b.settings.offlineSupportMinimizedText)):b.isButtonDisabled=!a};g.prototype.handleInvitationsResource=;g.prototype.appendInvitationsComponent=;g.prototype.processInvitations=;g.prototype.hasInviteButton=function(){return 0<Object.keys(b.liveAgentAPI.inviteButton).length&&b.liveAgentAPI.inviteButton.constructor===Object};g.prototype.startChat=;g.prototype.endChat=;
g.prototype.clearSession=;b.liveAgentAPI=new g});
