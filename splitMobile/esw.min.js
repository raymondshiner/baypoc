(function(l){function d(){var a=!1,b;this.settings={appendHelpButton:!0,displayHelpButton:!0,isExternalPage:!0,devMode:!1,targetElement:document.body,elementForOnlineDisplay:void 0,elementForOfflineDisplay:void 0,defaultMinimizedText:"",disabledMinimizedText:"",defaultAssistiveText:"",loadingText:"Loading",showIcon:void 0,enabledFeatures:[],entryFeature:"FieldService",storageDomain:document.domain,language:void 0,linkAction:{feature:void 0,name:void 0,valid:!1},linkActionParameters:{},useCustomAuthentication:!1,
allowGuestUsers:!1,requireSLDS:!1,hasBottomTabBar:!1};this.auth={};this.validLinkActions={};this.alwaysWarnOnBeforeUnload=!1;Object.defineProperty(this.auth,"oauthToken",{get:,set:.bind(this)});this.featureScripts={};this.storedEventHandlers={};this.messageHandlers={};this.storageKeys=
["ESW_BODY_SCROLL_POSITION","ESW_IS_MINIMIZED","ESW_MINIMIZED_TEXT","ESW_OAUTH_TOKEN"];this.defaultSettings={};this.snippetSettingsFile={};this.eswFrame=void 0;this.availableFeatures=["script","session"];this.outboundMessagesAwaitingIframeLoad=[];this.pendingMessages={};this.iframeScriptsToLoad=[];this.isAuthenticationRequired=this.isIframeReady=this.hasSessionDataLoaded=this.componentInitInProgress=this.domInitInProgress=!1;this.loginPendingSerializedData=void 0;this.componentLoaded=!1;Object.defineProperty(this,
"isButtonDisabled",{get:function(){return a},set:function(c){a=c;this.onButtonStatusChange()}.bind(this),configurable:!0});this.setupMessageListener();this.getLinkActionData()}var m=[".salesforce.com",".force.com",".sfdc.net"],n="liveagent.chatCanceledOnDifferentTab liveagent.fileTransfer.resetFileSelector liveagent.fileTransfer.uploadFile session.deletedSessionData session.onLoad session.sessionData session.updateMaster".split(" ");d.prototype.getLightningOutParamsObj=;d.prototype.adjustCommunityStorageDomain=function(){this.isCommunityDomain(this.settings.storageDomain)&&this.settings.storageDomain===
document.domain&&(this.settings.storageDomain=this.settings.storageDomain+"/"+window.location.pathname.split("/")[1])};d.prototype.loadLightningOutScripts=;d.prototype.instantiateLightningOutApplication=;d.prototype.createEmbeddedServiceComponent=;d.prototype.bootstrapEmbeddedService=;d.prototype.validateStartChatAttributes=;d.prototype.isInternetExplorer=;d.prototype.outputToConsole=function(a,b,c){if((c||this.settings.devMode)&&console&&console[a])console[a]("[Snap-ins] "+
(Array.isArray(b)?b.join(", "):b))};d.prototype.log=function(){this.outputToConsole("log",[].slice.apply(arguments))};d.prototype.error=;d.prototype.warning=;d.prototype.deprecated=;d.prototype.getCookie=function(a){var b=document.cookie;if(b){var c=b.indexOf(a+"=");if(-1!==c)return c+=(a+"=").length,a=b.indexOf(";",c),-1===a&&(a=b.length),b.substring(c,a)}};d.prototype.setCookie=;d.prototype.mergeSettings=function(a){Object.keys(a).forEach(function(b){void 0===
this.settings[b]&&(this.settings[b]=a[b])}.bind(this))};d.prototype.loadFeatureScript=function(a,b){var c=decodeURI(a).toLowerCase();-1===a.indexOf("..")?this.loadScriptFromDirectory("client",c+".esw",function(){this.featureScripts[a](this);this.availableFeatures.push(c);embedded_svc.utils.fireEvent("featureLoaded",void 0,a);b&&b();this.processPendingMessages(c)}.bind(this)):this.error('"'+a+'" is not a valid feature name.')};d.prototype.fireEvent=;d.prototype.isValidEntityId=function(a){return"string"===typeof a&&(18===a.length||15===a.length)};d.prototype.getKeyPrefix=function(a){if(this.isValidEntityId(a))return a.substr(0,3)};d.prototype.isOrganizationId=function(a){return"00D"===this.getKeyPrefix(a)};d.prototype.getESWFrame=function(){var a=document.getElementById("esw_storage_iframe");
!this.eswFrame&&a&&(this.eswFrame=a.contentWindow);return this.eswFrame};d.prototype.isFrameStorageEnabled=;d.prototype.processPendingMessages=function(a){this.pendingMessages[a]&&(this.pendingMessages[a].forEach(.bind(this)),this.pendingMessages[a]=void 0)};d.prototype.loadCSS=function(){var a=document.createElement("link");a.href=(this.settings.gslbBaseURL?this.settings.gslbBaseURL:this.settings.baseCoreURL)+
"/embeddedservice/"+this.settings.releaseVersion+"/esw"+(this.settings.devMode?"":".min")+".css";a.type="text/css";a.rel="stylesheet";document.getElementsByTagName("head")[0].appendChild(a)};d.prototype.appendHelpButton=function(a){var b=document.createElement("div"),c="";b.className="embeddedServiceHelpButton";this.isLanguageRtl(this.settings.language)&&this.isDesktop()&&(c='dir="rtl"');b.innerHTML='<div class="helpButton"'+c+'><button class="helpButtonEnabled uiButton" href="javascript:void(0)"><span class="embeddedServiceIcon" aria-hidden="true" data-icon="&#59648;"></span><span class="helpButtonLabel" id="helpButtonSpan" aria-live="polite" aria-atomic="true"><span class="assistiveText">'+
(this.settings.defaultAssistiveText||"")+'</span><span class="message"></span></span></button></div>';a||(b.style.display="none");this.settings.hasBottomTabBar&&b.classList.add("embeddedServiceBottomTabBar");this.settings.targetElement.appendChild(b);this.setHelpButtonText(this.settings.defaultMinimizedText);"ontouchstart"in document.documentElement&&[].slice.apply(document.querySelectorAll(".embeddedServiceHelpButton .uiButton")).forEach(function(e){e.classList.add("no-hover")});this.onButtonStatusChange()};
d.prototype.appendIFrame=function(){var a=document.createElement("iframe"),b={};a.id="esw_storage_iframe";a.src=this.settings.iframeURL;a.style.display="none";a.title="Live Chat Metadata";a.onload=function(){var c=this.getESWFrame();this.isIframeReady=!0;this.outboundMessagesAwaitingIframeLoad.forEach(.bind(this));this.outboundMessagesAwaitingIframeLoad=[];this.iframeScriptsToLoad.forEach(function(e){this.loadStorageScript(e)}.bind(this));b.deploymentId=
this.settings.deploymentId;b.isSamePageNavigation=this.isSamePageNavigation();b.isRefresh=1===window.performance.navigation.type;this.postMessage("session.updateStorage",b);this.iframeScriptsToLoad=[]}.bind(this);this.settings.targetElement.appendChild(a);window.addEventListener("beforeunload",.bind(this),!1)};d.prototype.preparePageForSidebar=;
d.prototype.createLightningComponent=;d.prototype.loadLightningApp=;d.prototype.initLightningOut=;d.prototype.setHelpButtonText=function(a,b){var c=void 0===this.settings.showIcon?!0:this.settings.showIcon;b=void 0===b?c:b;c=document.getElementById("helpButtonSpan");if(c){var e=c.querySelector(".message");e.innerHTML=a;if(a=c.parentElement.querySelector(".embeddedServiceIcon"))a.style.display=
b?"inline-block":"none"}};d.prototype.prepareDOM=function(){this.domInitInProgress||(this.domInitInProgress=!0,this.appendIFrame())};d.prototype.addSessionHandlers=function(){this.addMessageHandler("session.onLoad",function(){this.postMessage("session.get",this.storageKeys)}.bind(this));this.addMessageHandler("session.sessionData",function(a){this.alwaysWarnOnBeforeUnload=!a;this.resumeInitWithSessionData(a||{})}.bind(this));this.addMessageHandler("session.deletedSessionData",.bind(this));this.addMessageHandler("session.updatePrimary",.bind(this))};
d.prototype.addMetaTag=;d.prototype.init=function(a,b,c,e,f,h){this.settings.baseCoreURL=a;this.settings.communityEndpointURL=b;this.settings.gslbBaseURL=c?c:a;this.settings.orgId=e;this.settings.releaseVersion="5.0";this.settings.eswConfigDevName=f;this.mergeSettings(h||{});this.adjustCommunityStorageDomain();if("string"!==typeof this.settings.baseCoreURL)throw Error("Base core URL value must be a string.");
if(!this.isOrganizationId(this.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+this.settings.orgId);embedded_svc.utils?this.finishInit():this.loadScriptFromDirectory("utils","common",this.finishInit.bind(this))};d.prototype.finishInit=function(){this.storedEventHandlers&&(Object.getOwnPropertyNames(this.storedEventHandlers).forEach(.bind(this)),this.storedEventHandlers={});
if(!embedded_svc.utils.fireEvent("validateInit",function(a){return-1!==a.indexOf(!1)},this.settings)){this.checkForNativeFunctionOverrides();this.settings.appendHelpButton&&this.loadCSS();if(!this.settings.targetElement)throw Error("No targetElement specified");this.settings.iframeURL=this.settings.gslbBaseURL+"/embeddedservice/"+this.settings.releaseVersion+(this.settings.devMode?"/eswDev.html":"/esw.html")+"?parent="+document.location.href;this.addSessionHandlers();this.loadFeatures(this.onFeatureScriptsLoaded.bind(this));
this.settings.hasBottomTabBar=embedded_svc.utils.isUseriOS15plusSafari();embedded_svc.utils.fireEvent("afterInit",void 0,this.settings)}};d.prototype.onFeatureScriptsLoaded=function(){"complete"===document.readyState?setTimeout(this.prepareDOM.bind(this),1):document.addEventListener?(document.addEventListener("DOMContentLoaded",this.prepareDOM.bind(this),!1),window.addEventListener("load",this.prepareDOM.bind(this),!1)):window.attachEvent?window.attachEvent("onload",this.prepareDOM.bind(this)):this.log("No available event model. Exiting.")};
d.prototype.checkForNativeFunctionOverrides=function(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout".split(" ")}].forEach(function(a){a.functions.forEach(function(b){b in
a.object&&!this.isNativeFunction(a.object,b)&&this.warning("Embedded Service Chat may not function correctly with this native JS function modified: "+a.name+"."+b,!0)}.bind(this))}.bind(this))};d.prototype.isNativeFunction=function(a,b){return Function.prototype.toString.call(a[b]).match(/\[native code\]/)};d.prototype.onHelpButtonClick=;d.prototype.resumeInitWithSessionData=function(a){var b=embedded_svc.utils.fireEvent("sessionDataRetrieved",function(f){return-1!==f.indexOf(!0)},a),c=!1,e=!1;this.settings.linkAction.valid?c=!0:b?(this.log("Existing session found. Continuing with data: "+
a),e=c=!0,embedded_svc.menu&&embedded_svc.menu.hideTopContainer()):this.componentInitInProgress&&(c=!0);this.hasSessionDataLoaded=!0;a.ESW_OAUTH_TOKEN&&(this.auth.oauthToken=a.ESW_OAUTH_TOKEN);this.loginPendingSerializedData=e?a:void 0;c&&(this.componentInitInProgress=!0,this.checkAuthentication());this.settings.appendHelpButton&&this.appendHelpButton(this.settings.displayHelpButton&&!b)};d.prototype.checkAuthentication=;d.prototype.postMessage=function(a,b){a={domain:this.settings.storageDomain,data:b,method:a};(b=this.getESWFrame())?b.postMessage(a,this.settings.iframeURL):this.outboundMessagesAwaitingIframeLoad.push(a)};d.prototype.setSessionData=
function(a,b){if("object"===typeof a)var c=a;else c={},c[a]=b;this.postMessage("session.set",c)};d.prototype.deleteSessionData=;d.prototype.defineFeature=function(a,b){this.featureScripts[a]=b};d.prototype.registerStorageKeys=function(a){"string"===typeof a?this.storageKeys.push(a):a.forEach(function(b){this.storageKeys.push(b)}.bind(this))};d.prototype.addMessageHandler=function(a,b){this.messageHandlers[a]||(this.messageHandlers[a]=
[]);this.messageHandlers[a].push(b)};d.prototype.clearMessageHandlers=;d.prototype.loadStorageScript=function(a){this.isIframeReady?this.postMessage("script.load",a):this.iframeScriptsToLoad.push(a)};d.prototype.loadScriptFromDirectory=function(a,b,c,e){b=b.toLowerCase();var f=document.createElement("script"),h=this.settings.gslbBaseURL,g=b.replace(".",
"-")+"-script";f.id=g;f.type="text/javascript";f.src=[h,"embeddedservice",e?void 0:this.settings.releaseVersion,a,b+(this.settings.devMode?"":".min")+".js"].filter(function(k){return!!k}).join("/");c&&(f.onload=c);document.body.appendChild(f)};d.prototype.loadFeatures=function(a){this.settings.enabledFeatures.forEach(function(b){"base"!==b&&-1===this.availableFeatures.indexOf(b.toLowerCase())&&this.loadFeatureScript(b,a)}.bind(this))};d.prototype.addEventHandler=function(a,b){window.embedded_svc&&
embedded_svc.utils?embedded_svc.utils.addEventHandler(a,b):(this.storedEventHandlers[a]||(this.storedEventHandlers[a]=[]),this.storedEventHandlers[a].push(b))};d.prototype.setupMessageListener=function(){window.addEventListener("message",function(a){var b=a.data,c=a.origin.split(":")[1].replace("//",""),e=embedded_svc.utils?embedded_svc.utils.isProtocolHttpOrHttps(a.origin):!1,f=embedded_svc.utils?embedded_svc.utils.getHostnameFromUrl(this.settings.iframeURL):void 0;b&&b.method&&embedded_svc.isMessageFromSalesforceDomain(c)&&
e&&c===f&&("session.onLoad"===b.method&&-1===this.settings.iframeURL.indexOf(c)&&(c=this.settings.iframeURL.split("/")[2],a=a.origin.split("/")[2],this.settings.iframeURL=this.settings.iframeURL.replace(c,a)),a=b.method.split(".")[0].toLowerCase(),-1===this.availableFeatures.indexOf(a)?(this.pendingMessages[a]||(this.pendingMessages[a]=[]),this.pendingMessages[a].push({direction:"incoming",payload:b})):this.handleMessage(b))}.bind(this),!1)};d.prototype.handleMessage=function(a){var b=this.messageHandlers[a.method];
b?b.forEach(function(c){c(a.data)}):this.log("Unregistered method "+a.method+" received.")};d.prototype.isMessageFromSalesforceDomain=function(a){if(embedded_svc.utils.isCommunityOrSite()&&a===document.domain)return!0;var b=function(c,e){return-1!==c.indexOf(e,c.length-e.length)};return m.some(function(c){return b(a,c)})};d.prototype.isCommunityDomain=function(a){return".force.com"===a.substr(-10)};d.prototype.isSamePageNavigation=function(){var a=document.domain;if(this.isCommunityDomain(document.domain)){var b=
a+"/"+window.location.pathname.split("/")[1];b===this.settings.storageDomain&&(a=b)}return a.substr(-this.settings.storageDomain.length)===this.settings.storageDomain};d.prototype.addDefaultSetting=function(a,b){this.defaultSettings[a]=b};d.prototype.onButtonStatusChange=function(){var a=document.querySelector(".embeddedServiceHelpButton button"),b;if(embedded_svc.menu)embedded_svc.menu.onAgentAvailabilityChange();a&&(b=a.querySelector(".message"))&&(this.isButtonDisabled?(a.onclick=,
a.classList.remove("helpButtonEnabled"),a.classList.add("helpButtonDisabled"),b.innerHTML=this.settings.disabledMinimizedText):(a.onclick=this.onHelpButtonClick.bind(this),a.classList.remove("helpButtonDisabled"),a.classList.add("helpButtonEnabled"),b.innerHTML=this.settings.defaultMinimizedText))};d.prototype.hideHelpButton=;d.prototype.showHelpButton=;d.prototype.setDefaultButtonText=function(a,b,c,e){this.settings.entryFeature===a&&(this.settings.defaultMinimizedText=this.settings.defaultMinimizedText||b,this.settings.disabledMinimizedText=this.settings.disabledMinimizedText||c,this.settings.defaultAssistiveText=this.settings.defaultAssistiveText||e||"")};d.prototype.setDefaultShowIcon=;d.prototype.registerLinkAction=
;d.prototype.setLinkAction=;d.prototype.getLinkActionData=function(){window.location.search.replace(/([a-zA-Z0-9._]+)=([^&\s]+)/g,.bind(this))};d.prototype.requireAuthentication=;d.prototype.requireSLDS=;d.prototype.validateHeaderValue=;d.prototype.isLanguageRtl=function(a){if(a&&""!==a.trim())switch(a.substring(0,2)){case "ar":case "fa":case "he":case "iw":case "ji":case "ur":case "yi":return!0;
default:return!1}};d.prototype.isDesktop=;window.embedded_svc=new d;Object.getOwnPropertyNames(l).forEach()})(window.embedded_svc||{});
